<div class="pharmacies-container">
  <header class="consulta-header">
    <div class="header-content">
      <nav class="header-nav">
        <button
          class="nav-button"
          routerLink="/search"
          routerLinkActive="active"
        >
          <span class="material-icons">home</span>
          Inicio
        </button>
        <button
          class="nav-button"
          routerLink="/estoque"
          routerLinkActive="active"
        >
          <span class="material-icons">layers</span>
          Estoque
        </button>
        <button
          class="nav-button"
          routerLink="/profile"
          routerLinkActive="active"
        >
          <span class="material-icons">people</span>
          Perfil
        </button>

        <button
          class="nav-button"
          (click)="onLogout()"
          routerLinkActive="active"
        >
          Sair
        </button>
      </nav>
    </div>
  </header>

  <div class="page-content">
    <div class="page-header">
      <h2>Gerenciamento de Farmácias</h2>
      <button class="btn btn-primary" (click)="onNew()" *ngIf="isAdmin">
        <span class="material-icons">add</span>
        Nova Farmácia
      </button>
    </div>

    <div class="loading-container" *ngIf="isLoading">
      <div class="loading-spinner"></div>
      <p>Carregando farmácias...</p>
    </div>

    <div class="pharmacies-grid" *ngIf="!isLoading && pharmacies.length > 0">
      <div class="pharmacy-card" *ngFor="let pharmacy of pharmacies">
        <div class="pharmacy-header">
          <h3>{{ pharmacy.nomeFantasia }}</h3>
          <div class="pharmacy-actions" *ngIf="isAdmin">
            <button class="btn btn-sm btn-secondary" (click)="onEdit(pharmacy)">
              <span class="material-icons">edit</span>
            </button>
            <button
              class="btn btn-sm btn-danger"
              (click)="onDelete(pharmacy.id)"
            >
              <span class="material-icons">delete</span>
            </button>
          </div>
        </div>
        <div class="pharmacy-info">
          <p><strong>Endereço:</strong> {{ pharmacy.endereco }}</p>
          <p>
            <strong>Cidade:</strong> {{ pharmacy.municipio }}/{{ pharmacy.uf }}
          </p>
          <p></p>
          <p>
            <strong>Horario de funcionamento:</strong>
            {{ pharmacy.horarioFuncionamento || "-" }}
          </p>
          <p><strong>Telefone:</strong> {{ pharmacy.telefone || "-" }}</p>
        </div>
      </div>
    </div>

    <div class="no-data" *ngIf="!isLoading && pharmacies.length === 0">
      <span class="material-icons">local_pharmacy_off</span>
      <h3>Nenhuma farmácia encontrada</h3>
      <p>Clique em "Nova Farmácia" para adicionar a primeira farmácia.</p>
    </div>
  </div>
</div>

<div class="modal-overlay" *ngIf="showForm" (click)="closeForm()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>{{ selectedPharmacy?.id ? "Editar" : "Nova" }} Farmácia</h2>
      <button class="btn-close" (click)="closeForm()">
        <span class="material-icons">close</span>
      </button>
    </div>
    <form
      class="pharmacy-form"
      *ngIf="selectedPharmacy"
      (ngSubmit)="onSave(selectedPharmacy)"
    >
      <div class="form-row">
        <div class="form-group">
          <label>Nome Fantasia</label>
          <input
            type="text"
            [(ngModel)]="selectedPharmacy.nomeFantasia"
            name="fantasyName"
            required
          />
        </div>
        <div class="form-group">
          <label>CNPJ</label>
          <input
            type="text"
            [(ngModel)]="selectedPharmacy.cnpj"
            name="cnpj"
            required
          />
        </div>
      </div>
      <div class="form-group">
        <label>CEP</label>
        <input
          type="text"
          [(ngModel)]="selectedPharmacy.cep"
          name="cep"
          required
        />
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>Rua</label>
          <input
            type="text"
            [(ngModel)]="selectedPharmacy.endereco"
            name="street"
            required
          />
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>Cidade</label>
          <input
            type="text"
            [(ngModel)]="selectedPharmacy.municipio"
            name="city"
            required
          />
        </div>
        <div class="form-group">
          <label>Estado</label>
          <input
            type="text"
            [(ngModel)]="selectedPharmacy.uf"
            name="state"
            required
          />
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>Número de Medicamentos</label>
          <input
            type="number"
            [(ngModel)]="selectedPharmacy.numberMedications"
            name="numberMedications"
            required
          />
        </div>
      </div>
      <div class="form-actions">
        <button type="button" class="btn btn-secondary" (click)="closeForm()">
          Cancelar
        </button>
        <button type="submit" class="btn btn-primary">Salvar</button>
      </div>
    </form>
  </div>
</div>
